<!-- 发现页 -->
<view class="discover-tab">
  <!-- 搜索区域 -->
  <view class="search-section">
    <t-search
      placeholder="搜索附近的信息"
      value="{{ searchValue }}"
      bind:change="onSearchChange"
      bind:submit="onSearchSubmit" />
  </view>

  <!-- 分类Tabs -->
  <view class="tabs-section">
    <t-tabs value="{{ activeTab }}" bind:change="onTabChange" space-evenly="{{false}}">
      <t-tab-panel label="求租/出租" value="rental" />
      <t-tab-panel label="美食推荐" value="food" />
      <t-tab-panel label="二手交易" value="used" />
      <t-tab-panel label="周边服务" value="service" />
    </t-tabs>
  </view>

  <!-- 筛选区域 -->
  <view class="filter-section">
    <view class="filter-header">
      <text class="filter-title">筛选</text>
      <text class="filter-reset" bindtap="onResetFilter">重置</text>
    </view>
    <view class="filter-tags">
      <view
        wx:for="{{ currentFilters }}"
        wx:key="value"
        class="filter-tag {{ selectedFilters.indexOf(item.value) > -1 ? 'active' : '' }}"
        data-value="{{ item.value }}"
        bindtap="onFilterTap">
        {{ item.label }}
      </view>
    </view>
  </view>

  <!-- 列表区域 -->
  <view class="list-section">
    <view class="list-header">
      <text class="result-count">找到 {{ posts.length }} 条结果</text>
      <view class="sort-btn" bindtap="onSortTap">
        <t-icon name="filter" size="14" color="#1677FF" />
        <text>排序</text>
      </view>
    </view>

    <!-- 动态列表 -->
    <view class="post-list">
      <view class="post-item" wx:for="{{ posts }}" wx:key="id" data-id="{{ item.id }}" bindtap="onPostTap">
        <!-- 帖子头部 -->
        <view class="post-header">
          <view class="user-info">
            <view class="avatar">
              <t-icon name="user" size="24" color="#999" />
            </view>
            <view class="user-meta">
              <text class="username">{{ item.author }}</text>
              <text class="post-time">{{ item.time }}</text>
            </view>
          </view>
          <t-tag wx:if="{{ item.category }}" theme="primary" variant="light" size="small">{{ item.category }}</t-tag>
        </view>

        <!-- 帖子内容 -->
        <view class="post-content">
          <view class="post-title">{{ item.title }}</view>
          <view class="post-desc">{{ item.content }}</view>

          <!-- 图片网格 -->
          <view wx:if="{{ item.images && item.images.length > 0 }}" class="post-images">
            <view 
              class="image-item {{ item.images.length === 1 ? 'single' : '' }}" 
              wx:for="{{ item.images }}" 
              wx:for-item="img" 
              wx:key="*this">
              <t-image src="{{ img }}" mode="aspectFill" class="post-image" />
            </view>
          </view>

          <!-- 详细信息卡片 -->
          <view wx:if="{{ item.price || item.location }}" class="post-detail-card">
            <view wx:if="{{ item.price }}" class="detail-price">
              <text class="price-symbol">¥</text>
              <text class="price-value">{{ item.price }}</text>
              <text class="price-unit" wx:if="{{ item.type === 'rental' }}">/月</text>
            </view>
            <view wx:if="{{ item.location }}" class="detail-info">
              <t-icon name="location" size="12" color="#999" />
              <text>{{ item.location }}</text>
            </view>
          </view>
          <!-- 租房信息 -->
          <view wx:if="{{ item.type === 'rental' && (item.rentType || item.layout) }}" class="post-meta">
            <text wx:if="{{ item.rentType }}" class="meta-item">{{ item.rentType }}</text>
            <text wx:if="{{ item.layout }}" class="meta-item">{{ item.layout }}</text>
          </view>
          <!-- 美食信息 -->
          <view wx:if="{{ item.type === 'food' && (item.foodCategory || item.perCapita) }}" class="post-meta">
            <text wx:if="{{ item.foodCategory }}" class="meta-item">{{ item.foodCategory }}</text>
            <text wx:if="{{ item.perCapita }}" class="meta-item">人均¥{{ item.perCapita }}</text>
          </view>
          <!-- 二手信息 -->
          <view wx:if="{{ item.type === 'used' && item.quality }}" class="post-meta">
            <text class="meta-item">{{ item.quality }}</text>
          </view>
          <!-- 服务信息 -->
          <view wx:if="{{ item.type === 'service' && (item.serviceType || item.refPrice) }}" class="post-meta">
            <text wx:if="{{ item.serviceType }}" class="meta-item">{{ item.serviceType }}</text>
            <text wx:if="{{ item.refPrice }}" class="meta-item">{{ item.refPrice }}</text>
          </view>
        </view>

        <!-- 操作栏 -->
        <view class="post-actions">
          <view class="action-btn action-contact" data-id="{{ item.id }}" catchtap="onContactTap">
            <t-icon name="service" size="16" color="#1677FF" />
            <text>联系TA</text>
          </view>
        </view>
      </view>

      <!-- 空状态 -->
      <view wx:if="{{ posts.length === 0 }}" class="empty-state">
        <t-icon name="info-circle" size="48" color="#ccc" />
        <text class="empty-text">暂无相关信息</text>
      </view>
    </view>
  </view>
</view>
